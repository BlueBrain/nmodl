# *********************************************************************
# Copyright (C) 2018-2019 Blue Brain Project
#
# This file is part of NMODL distributed under the terms of the GNU
# Lesser General Public License. See top-level LICENSE file for details.
# *********************************************************************

######################### NMODL Abstract Language Definition ##############################
#
# PURPOSE
# =======
#
# Lot of information about language constructs is necessary at various stages
# like AST definitions, visitors implementation, source-to-source transformations
# etc. In case of small changes in grammar or AST definition, especially
# during development stage, we have to re-write considerable part of the code.
# The idea of "abstract" language definition is to define framework that can automatically
# generate part of this "mechanical" code. This approach has been used in some open source
# projects (e.g. compiler design courses, TableGen format in LLVM).
#
# During first prototyping phase we defined simple text rules inspired by compiler course
# assignment available at jazariethach/project6_CS160.git (no longer available on github).
#
# The basic format of the every construct specification was:
#
#       BaseType:ChildType => MemberType<member_name>
#
# Here "ChildType" is a new AST class that we are defining. "ParentType" is the base class,
# "MemberType" is the type of member variable with variable name "member_name". The name is
# specified in the angle braces "< >". This will generate C++ class definition like :
#
#       class ChildType : public BaseType {
#         private:
#           MemberType member_name;
#       };
#
# This specification format was sufficient for first AST design but as we started
# implementing more features and compiler passes, we need to add more information to language
# definition. For example, we need to make certain members vector, some are optional, some need
# specific method (getter/setter) etc. In the future we may need to make certain members private.
# Above text definition is limiting if we have to accomodate future enhancements.
#
# To overcome above limitation, we are moving to YAML definition format. This allows easy
# extension to language construct. For example, new properties could be easily added to
# exisiting specification.
#
#
# NOTE
# ====
#
# Old text specification has been converted to YAML format. The old documentation has information
# about how/why specific types were choosen for AST. You can find that documentation in the older
# commits of this file (e.g. a0a20e277ccf26752af4f648c245b4e06a44af20).
#
# YAML BASED RULE SPECIFICATION
# =============================
#
# Text based specification described above is very limiting in terms adding extra properties.
# YAML based specification allows easy addition of new properties. Below are some comments
# about the properties and specification :
#
# 1.  Every key in YAML specification is AST node
# 2.  The hierarchy defines parent-child class relationship
# 3.  members is an array of member variables of the class
# 4.  optional : indicates if variable is optional in bison specification (i.e. pointer)
# 5.  type : type of the member
# 6.  vector : if member variable is std::vector type
# 7.  prefix/suffix :
#         value  : indicates the value (i.e. string here) of prefix/suffix itself
#         force  : print value always even if member if null pointer itself (e.g. arguments)
# 8.  separator : for the vector data type, the separator for prinitng elements
# 9.  node_name : add get_node_name() method to class and return corresponding value as name
# 10. add : need to have addMemberType method for corresponding variable (todo : remove this)
# 11. order of the members is important and determines how constructors/nmodl visitor get
#     defined from python code generators.
#
# TODO : Add detailed information about YAML specification by porting old text based rule
# specification

- AST:
    description: "Base class for AST"
    children:
      - Node:
          description: "Base class for node in the AST"
          children:
            - Expression:
                description: "Represents a(n) expression"
                children:
                  - String:
                      description: "Represents a(n) double quoted string"
                      members:
                        - value:
                            description: "string value"
                            type: std::string
                  - Number:
                      description: "Represents a(n) number"
                      children:
                        - Integer:
                            description: "Represents a(n) integer number"
                            members:
                              - value:
                                  description: "integer value"
                                  type: int
                              - macro:
                                  description: "macro name for integer"
                                  type: Name
                                  optional: true
                        - Float:
                            description: "Represents a(n) float number"
                            members:
                              - value:
                                  description: "float value"
                                  type: float
                        - Double:
                            description: "Represents a(n) double number"
                            members:
                              - value:
                                  description: "double value"
                                  type: double
                        - Boolean:
                            description: "Represents a(n) boolean variable"
                            members:
                              - value:
                                  description: "bool value"
                                  type: int
                  - Identifier:
                      description: "Represents a(n) identifier"
                      children:
                        - Name:
                            description: "Represents a(n) name"
                            members:
                              - value:
                                  description: "string value"
                                  type: String
                                  node_name: true
                        - PrimeName:
                            description: "Represents a(n) prime variable"
                            members:
                              - value:
                                  description: "variable name"
                                  type: String
                                  node_name: true
                              - order:
                                  description: "order of prime"
                                  type: Integer
                        - VarName:
                            description: "Represents a(n) NMODL variable"
                            members:
                              - name:
                                  description: "variable name"
                                  type: Identifier
                                  node_name: true
                              - at:
                                  description: "todo : Michael to define the semantics of this"
                                  type: Integer
                                  optional: true
                                  prefix: {value: "@"}
                              - index:
                                  description: "index value in case of array"
                                  type: Expression
                                  optional: true
                                  prefix: {value: "["}
                                  suffix: {value: "]"}
                        - IndexedName:
                            description: ".."
                            members:
                              - name:
                                  description: "..."
                                  type: Identifier
                                  node_name: true
                              - length:
                                  description: "..."
                                  type: Expression
                                  prefix: {value: "["}
                                  suffix: {value: "]"}
                        - Argument:
                            description: ".."
                            members:
                              - name:
                                  description: "..."
                                  type: Identifier
                                  node_name: true
                              - unit:
                                  description: "..."
                                  type: Unit
                                  optional: true
                        - ReactVarName:
                            description: ".."
                            members:
                              - value:
                                  description: "..."
                                  type: Integer
                                  optional: true
                                  prefix: {value: " "}
                              - name:
                                  description: "..."
                                  type: VarName
                                  node_name: true
                        - ReadIonVar:
                            description: ".."
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                        - WriteIonVar:
                            description: ".."
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                        - NonspecificCurVar:
                            description: ".."
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                        - ElectrodeCurVar:
                            description: ".."
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                        - SectionVar:
                            description: ".."
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                        - RangeVar:
                            description: ".."
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                        - GlobalVar:
                            description: ".."
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                        - PointerVar:
                            description: ".."
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                        - BbcorePointerVar:
                            description: ".."
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                        - ExternVar:
                            description: ".."
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                        - ThreadsafeVar:
                            description: ".."
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                  - Block:
                      description: ".."
                      children:
                        - ParamBlock:
                            description: ".."
                            nmodl: "PARAMETER "
                            members:
                              - statements:
                                  description: "..."
                                  type: ParamAssign
                                  vector: true
                        - StepBlock:
                            description: ".."
                            nmodl: "STEPPED "
                            members:
                              - statements:
                                  description: "..."
                                  type: Stepped
                                  vector: true
                        - IndependentBlock:
                            description: ".."
                            nmodl: "INDEPENDENT "
                            members:
                              - definitions:
                                  description: "..."
                                  type: IndependentDef
                                  vector: true
                        - DependentBlock:
                            description: ".."
                            nmodl: "ASSIGNED "
                            members:
                              - definitions:
                                  description: "..."
                                  type: DependentDef
                                  vector: true
                        - StateBlock:
                            description: ".."
                            nmodl: "STATE "
                            members:
                              - definitions:
                                  description: "..."
                                  type: DependentDef
                                  vector: true
                        - PlotBlock:
                            description: ".."
                            members:
                              - plot:
                                  description: "..."
                                  type: PlotDeclaration
                        - InitialBlock:
                            description: ".."
                            nmodl: "INITIAL "
                            members:
                              - statement_block:
                                  description: "..."
                                  type: StatementBlock
                                  getter: {override: true}
                        - ConstructorBlock:
                            description: ".."
                            nmodl: "CONSTRUCTOR "
                            members:
                              - statement_block:
                                  description: "..."
                                  type: StatementBlock
                                  getter: {override: true}
                        - DestructorBlock:
                            description: ".."
                            nmodl: "DESTRUCTOR "
                            members:
                              - statement_block:
                                  description: "..."
                                  type: StatementBlock
                                  getter: {override: true}
                        - StatementBlock:
                            description: ".."
                            members:
                              - statements:
                                  description: "..."
                                  type: Statement
                                  vector: true
                                  public: true
                                  add: true
                        - DerivativeBlock:
                            description: ".."
                            nmodl: "DERIVATIVE "
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                                  suffix: {value: " "}
                              - statement_block:
                                  description: "..."
                                  type: StatementBlock
                                  getter: {override: true}
                        - LinearBlock:
                            description: ".."
                            nmodl: "LINEAR "
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                                  suffix: {value: " "}
                              - solvefor:
                                  description: "..."
                                  type: Name
                                  vector: true
                                  separator: ","
                                  prefix: {value: " SOLVEFOR "}
                              - statement_block:
                                  description: "..."
                                  type: StatementBlock
                                  getter: {override: true}
                        - NonLinearBlock:
                            description: ".."
                            nmodl: "NONLINEAR "
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                              - solvefor:
                                  description: "..."
                                  type: Name
                                  vector: true
                                  separator: ","
                                  prefix: {value: " SOLVEFOR "}
                                  suffix: {value: " ", force: true}
                              - statement_block:
                                  description: "..."
                                  type: StatementBlock
                                  getter: {override: true}
                        - DiscreteBlock:
                            description: ".."
                            nmodl: "DISCRETE "
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                                  suffix: {value: " "}
                              - statement_block:
                                  description: "..."
                                  type: StatementBlock
                                  getter: {override: true}
                        - PartialBlock:
                            description: ".."
                            nmodl: "PARTIAL "
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                                  suffix: {value: " "}
                              - statement_block:
                                  description: "..."
                                  type: StatementBlock
                                  getter: {override: true}
                        - FunctionTableBlock:
                            description: ".."
                            nmodl: "FUNCTION_TABLE "
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                              - parameters:
                                  description: "..."
                                  type: Argument
                                  vector: true
                                  prefix: {value: "(", force: true}
                                  suffix: {value: ")", force: true}
                                  separator: ", "
                                  getter: {override: true}
                              - unit:
                                  description: "..."
                                  type: Unit
                                  optional: true
                                  prefix: {value: " "}
                        - FunctionBlock:
                            description: ".."
                            nmodl: "FUNCTION "
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                              - parameters:
                                  description: "..."
                                  type: Argument
                                  vector: true
                                  prefix: {value: "(", force: true}
                                  suffix: {value: ")", force: true}
                                  separator: ", "
                                  getter: {override: true}
                              - unit:
                                  description: "..."
                                  type: Unit
                                  optional: true
                                  prefix: {value: " "}
                                  suffix: {value: " ", force: true}
                              - statement_block:
                                  description: "..."
                                  type: StatementBlock
                                  getter: {override: true}
                        - ProcedureBlock:
                            description: ".."
                            nmodl: "PROCEDURE "
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                              - parameters:
                                  description: "..."
                                  type: Argument
                                  vector: true
                                  prefix: {value: "(", force: true}
                                  suffix: {value: ") ", force: true}
                                  separator: ", "
                                  getter: {override: true}
                              - unit:
                                  description: "..."
                                  type: Unit
                                  optional: true
                              - statement_block:
                                  description: "..."
                                  type: StatementBlock
                                  getter: {override: true}
                        - NetReceiveBlock:
                            description: ".."
                            nmodl: "NET_RECEIVE "
                            members:
                              - parameters:
                                  description: "..."
                                  type: Argument
                                  vector: true
                                  prefix: {value: "(", force: true}
                                  suffix: {value: ") ", force: true}
                                  separator: ", "
                                  getter: {override: true}
                              - statement_block:
                                  description: "..."
                                  type: StatementBlock
                                  getter: {override: true}
                        - SolveBlock:
                            description: ".."
                            nmodl: SOLVE
                            members:
                              - block_name:
                                  description: "..."
                                  type: Name
                                  prefix: {value: " "}
                              - method:
                                  description: "..."
                                  type: Name
                                  optional: true
                                  prefix: {value: " METHOD "}
                              - ifsolerr:
                                  description: "..."
                                  type: StatementBlock
                                  optional: true
                                  prefix: {value: " IFERROR "}
                        - BreakpointBlock:
                            description: ".."
                            nmodl: "BREAKPOINT "
                            members:
                              - statement_block:
                                  description: "..."
                                  type: StatementBlock
                                  getter: {override: true}
                        - TerminalBlock:
                            description: ".."
                            nmodl: "TERMINAL "
                            members:
                              - statement_block:
                                  description: "..."
                                  type: StatementBlock
                                  getter: {override: true}
                        - BeforeBlock:
                            description: ".."
                            nmodl: "BEFORE "
                            members:
                              - bablock:
                                  description: "..."
                                  type: BABlock
                        - AfterBlock:
                            description: ".."
                            nmodl: "AFTER "
                            members:
                              - bablock:
                                  description: "..."
                                  type: BABlock
                        - BABlock:
                            description: ".."
                            members:
                              - type:
                                  description: "..."
                                  type: BABlockType
                                  suffix: {value: " "}
                              - statement_block:
                                  description: "..."
                                  type: StatementBlock
                                  getter: {override: true}
                        - ForNetcon:
                            description: ".."
                            nmodl: "FOR_NETCONS "
                            members:
                              - parameters:
                                  description: "..."
                                  type: Argument
                                  vector: true
                                  prefix: {value: "(", force: true}
                                  suffix: {value: ") ", force: true}
                                  separator: ", "
                                  getter: {override: true}
                              - statement_block:
                                  description: "..."
                                  type: StatementBlock
                                  getter: {override: true}
                        - KineticBlock:
                            description: ".."
                            nmodl: "KINETIC "
                            members:
                              - name:
                                  description: "..."
                                  type: Name
                                  node_name: true
                                  suffix: {value: " "}
                              - solvefor:
                                  description: "..."
                                  type: Name
                                  vector: true
                                  separator: ","
                              - statement_block:
                                  description: "..."
                                  type: StatementBlock
                                  getter: {override: true}
                        - MatchBlock:
                            description: ".."
                            nmodl: MATCH
                            members:
                              - matchs:
                                  description: "..."
                                  type: Match
                                  vector: true
                                  separator: " "
                                  prefix: {value: " { "}
                                  suffix: {value: " }"}
                        - UnitBlock:
                            description: ".."
                            nmodl: "UNITS "
                            members:
                              - definitions:
                                  description: "..."
                                  type: Expression
                                  vector: true
                        - ConstantBlock:
                            description: ".."
                            nmodl: "CONSTANT "
                            members:
                              - statements:
                                  description: "..."
                                  type: ConstantStatement
                                  vector: true
                        - NeuronBlock:
                            description: ".."
                            url: "https://www.neuron.yale.edu/neuron/static/py_doc/modelspec/programmatic/mechanisms/nmodl2.html#neuron"
                            nmodl: "NEURON "
                            members:
                              - statement_block:
                                  description: "..."
                                  type: StatementBlock
                                  getter: {override: true}
                  - Unit:
                      description: ".."
                      members:
                        - name:
                            description: "..."
                            type: String
                            node_name: true
                            prefix: {value: "("}
                            suffix: {value: ")"}
                  - DoubleUnit:
                      description: ".."
                      members:
                        - value:
                            description: "..."
                            type: Double
                        - unit:
                            description: "..."
                            type: Unit
                            optional: true
                  - LocalVar:
                      description: ".."
                      members:
                        - name:
                            description: "..."
                            type: Identifier
                            node_name: true
                  - Limits:
                      description: ".."
                      members:
                        - min:
                            description: "..."
                            type: Double
                            prefix: {value: "<"}
                            suffix: {value: ","}
                        - max:
                            description: "..."
                            type: Double
                            suffix: {value: ">"}
                  - NumberRange:
                      description: ".."
                      members:
                        - min:
                            description: "..."
                            type: Number
                            prefix: {value: "<"}
                            suffix: {value: ","}
                        - max:
                            description: "..."
                            type: Number
                            suffix: {value: ">"}
                  - PlotVar:
                      description: ".."
                      members:
                        - name:
                            description: "..."
                            type: Identifier
                        - index:
                            description: "..."
                            type: Integer
                            optional: true
                            prefix: {value: "["}
                            suffix: {value: "]"}
                  - ConstantVar:
                      description: ".."
                      members:
                        - name:
                            description: "..."
                            type: Name
                            node_name: true
                        - value:
                            description: "..."
                            type: Number
                            prefix: {value: " = "}
                        - unit:
                            description: "..."
                            type: Unit
                            optional: true
                            prefix: {value: " "}
                  - BinaryOperator:
                      description: ".."
                      members:
                        - value:
                            description: "..."
                            type: BinaryOp
                  - UnaryOperator:
                      description: ".."
                      members:
                        - value:
                            description: "..."
                            type: UnaryOp
                  - ReactionOperator:
                      description: ".."
                      members:
                        - value:
                            description: "..."
                            type: ReactionOp
                  - WrappedExpression:
                      description: ".."
                      members:
                        - expression:
                            description: "..."
                            type: Expression
                  - ParenExpression:
                      description: ".."
                      members:
                        - expression:
                            description: "..."
                            type: Expression
                            prefix: {value: "("}
                            suffix: {value: ")"}
                  - BinaryExpression:
                      description: ".."
                      members:
                        - lhs:
                            description: "..."
                            type: Expression
                            public: true
                        - op:
                            description: "..."
                            type: BinaryOperator
                            public: true
                        - rhs:
                            description: "..."
                            type: Expression
                            public: true
                  - DiffEqExpression:
                      description: "Represents differential equation in DERIVATIVE block"
                      members:
                        - expression:
                            description: "Differential Expression"
                            type: BinaryExpression
                            public: true
                  - UnaryExpression:
                      description: ".."
                      members:
                        - op:
                            description: "..."
                            type: UnaryOperator
                        - expression:
                            description: "..."
                            type: Expression
                  - NonLinEquation:
                      description: ".."
                      nmodl: "~ "
                      members:
                        - lhs:
                            description: "..."
                            type: Expression
                            suffix: {value: " = "}
                        - rhs:
                            description: "..."
                            type: Expression
                  - LinEquation:
                      description: ".."
                      nmodl: "~ "
                      members:
                        - left_linxpression:
                            description: "..."
                            type: Expression
                            suffix: {value: " = "}
                        - linxpression:
                            description: "..."
                            type: Expression
                  - FunctionCall:
                      description: ".."
                      members:
                        - name:
                            description: "..."
                            type: Name
                            node_name: true
                        - arguments:
                            description: "..."
                            type: Expression
                            vector: true
                            separator: ", "
                            prefix: {value: "(", force: true}
                            suffix: {value: ")", force: true}
                  - FirstLastTypeIndex:
                      description: ".."
                      members:
                        - value:
                            description: "..."
                            type: FirstLastType
                  - Watch:
                      description: ".."
                      members:
                        - expression:
                            description: "..."
                            type: Expression
                            prefix: {value: "("}
                            suffix: {value: ")"}
                        - value:
                            description: "..."
                            type: Expression
                            prefix: {value: " "}
                  - QueueExpressionType:
                      description: ".."
                      members:
                        - value:
                            description: "..."
                            type: QueueType
                  - Match:
                      description: ".."
                      members:
                        - name:
                            description: "..."
                            type: Identifier
                        - expression:
                            description: "..."
                            type: Expression
                            optional: true
                  - BABlockType:
                      description: ".."
                      members:
                        - value:
                            description: "..."
                            type: BAType
                  - UnitDef:
                      description: ".."
                      members:
                        - unit1:
                            description: "..."
                            type: Unit
                            node_name: true
                        - unit2:
                            description: "..."
                            type: Unit
                            prefix: {value: " = "}
                  - FactorDef:
                      description: ".."
                      members:
                        - name:
                            description: "..."
                            type: Name
                            node_name: true
                            suffix: {value: " ="}
                        - value:
                            description: "..."
                            type: Double
                            optional: true
                            prefix: {value: " "}
                        - unit1:
                            description: "..."
                            type: Unit
                            prefix: {value: " "}
                        - gt:
                            description: "Todo: @Michael : rename variable gt as well"
                            type: Boolean
                            nmodl: " ->"
                            optional: true
                        - unit2:
                            description: "..."
                            type: Unit
                            optional: true
                            prefix: {value: " "}
                  - Valence:
                      description: ".."
                      members:
                        - type:
                            type: Name
                            description: "..."
                            prefix: {value: " "}
                            suffix: {value: " "}
                        - value:
                            description: "..."
                            type: Double

            - Statement:
                description: ".."
                children:
                  - UnitState:
                      description: ".."
                      members:
                        - value:
                            description: "..."
                            type: UnitStateType
                  - LocalListStatement:
                      description: ".."
                      nmodl: "LOCAL "
                      members:
                        - variables:
                            description: "..."
                            type: LocalVar
                            vector: true
                            separator: ", "
                            public: true
                  - Model:
                      description: ".."
                      nmodl: TITLE
                      members:
                        - title:
                            description: "..."
                            type: String
                  - Define:
                      description: ".."
                      nmodl: "DEFINE "
                      members:
                        - name:
                            description: "..."
                            type: Name
                        - value:
                            description: "..."
                            type: Integer
                            prefix: {value: " "}
                  - Include:
                      description: ".."
                      nmodl: "INCLUDE "
                      members:
                        - filename:
                            description: "..."
                            type: String
                  - ParamAssign:
                      description: ".."
                      members:
                        - name:
                            description: "..."
                            type: Identifier
                            node_name: true
                        - value:
                            description: "..."
                            type: Number
                            optional: true
                            prefix: {value: " = "}
                        - unit:
                            description: "..."
                            type: Unit
                            optional: true
                            prefix: {value: " "}
                        - limit:
                            description: "..."
                            type: Limits
                            optional: true
                            prefix: {value: " "}
                  - Stepped:
                      description: ".."
                      members:
                        - name:
                            description: "..."
                            type: Name
                        - values:
                            description: "..."
                            type: Number
                            vector: true
                            prefix: {value: " = "}
                            separator: ", "
                        - unit:
                            description: "..."
                            type: Unit
                            optional: true
                            prefix: {value: " "}
                  - IndependentDef:
                      description: ".."
                      members:
                        - sweep:
                            description: "..."
                            type: Boolean
                            optional: true
                            nmodl: "SWEEP "
                        - name:
                            description: "..."
                            type: Name
                        - from:
                            description: "..."
                            type: Number
                            prefix: {value: " FROM "}
                        - to:
                            description: "..."
                            type: Number
                            prefix: {value: " TO "}
                        - with:
                            description: "..."
                            type: Integer
                            prefix: {value: " WITH "}
                        - start:
                            description: "..."
                            type: Number
                            prefix: {value: " START "}
                            optional: true
                        - unit:
                            description: "..."
                            type: Unit
                            optional: true
                            prefix: {value: " "}
                  - DependentDef:
                      description: ".."
                      members:
                        - name:
                            description: "..."
                            type: Identifier
                            node_name: true
                        - length:
                            description: "..."
                            type: Integer
                            optional: true
                            prefix: {value: "["}
                            suffix: {value: "]"}
                        - from:
                            description: "..."
                            type: Number
                            prefix: {value: " FROM "}
                            optional: true
                        - to:
                            description: "..."
                            type: Number
                            prefix: {value: " TO "}
                            optional: true
                        - start:
                            description: "..."
                            type: Number
                            prefix: {value: " START "}
                            optional: true
                        - unit:
                            description: "..."
                            type: Unit
                            optional: true
                            prefix: {value: " "}
                        - abstol:
                            description: "..."
                            type: Double
                            prefix: {value: " <"}
                            suffix: {value: ">"}
                            optional: true
                  - PlotDeclaration:
                      description: ".."
                      nmodl: "PLOT "
                      members:
                        - variables:
                            description: "..."
                            type: PlotVar
                            vector: true
                            separator: ", "
                        - name:
                            description: "..."
                            type: PlotVar
                            prefix: {value: " VS "}
                  - ConductanceHint:
                      description: ".."
                      nmodl: "CONDUCTANCE "
                      members:
                        - conductance:
                            description: "..."
                            type: Name
                        - ion:
                            description: "..."
                            type: Name
                            optional: true
                            prefix: {value: " USEION "}
                  - ExpressionStatement:
                      description: ".."
                      members:
                        - expression:
                            description: "..."
                            type: Expression
                  - ProtectStatement:
                      description: ".."
                      nmodl: "PROTECT "
                      members:
                        - expression:
                            description: "..."
                            type: Expression
                  - FromStatement:
                      description: ".."
                      nmodl: "FROM "
                      members:
                        - name:
                            description: "..."
                            type: Name
                            node_name: true
                        - from:
                            description: "..."
                            type: Expression
                            prefix: {value: " = "}
                        - to:
                            description: "..."
                            type: Expression
                            prefix: {value: " TO "}
                        - increment:
                            description: "..."
                            type: Expression
                            prefix: {value: " BY "}
                            suffix: {value: " ", force: true}
                            optional: true
                        - statement_block:
                            description: "..."
                            type: StatementBlock
                            getter: {override: true}
                  - ForAllStatement:
                      description: ".."
                      nmodl: "FORALL "
                      members:
                        - name:
                            description: "..."
                            type: Name
                            suffix: {value: " "}
                        - statement_block:
                            description: "..."
                            type: StatementBlock
                            getter: {override: true}
                  - WhileStatement:
                      description: ".."
                      nmodl: "WHILE "
                      members:
                        - condition:
                            description: "..."
                            type: Expression
                            prefix: {value: "("}
                            suffix: {value: ") "}
                        - statement_block:
                            description: "..."
                            type: StatementBlock
                            getter: {override: true}
                  - IfStatement:
                      description: ".."
                      nmodl: "IF "
                      members:
                        - condition:
                            description: "..."
                            type: Expression
                            prefix: {value: "("}
                            suffix: {value: ") "}
                        - statement_block:
                            description: "..."
                            type: StatementBlock
                            getter: {override: true}
                        - elseifs:
                            description: "..."
                            type: ElseIfStatement
                            vector: true
                        - elses:
                            description: "..."
                            type: ElseStatement
                            optional: true
                  - ElseIfStatement:
                      description: ".."
                      nmodl: " ELSE IF "
                      members:
                        - condition:
                            description: "..."
                            type: Expression
                            prefix: {value: "("}
                            suffix: {value: ") "}
                        - statement_block:
                            description: "..."
                            type: StatementBlock
                            getter: {override: true}
                  - ElseStatement:
                      description: ".."
                      nmodl: " ELSE "
                      members:
                        - statement_block:
                            description: "..."
                            type: StatementBlock
                            getter: {override: true}
                  - PartialEquation:
                      description: ".."
                      members:
                        - prime:
                            description: "..."
                            type: PrimeName
                        - name1:
                            description: "..."
                            type: Name
                        - name2:
                            description: "..."
                            type: Name
                        - name3:
                            description: "..."
                            type: Name
                  - PartialBoundary:
                      description: ".."
                      nmodl: "~ "
                      members:
                        - del:
                            description: "..."
                            type: Name
                            optional: true
                            suffix: {value: " "}
                        - name:
                            description: "..."
                            type: Identifier
                        - index:
                            description: "..."
                            type: FirstLastTypeIndex
                            optional: true
                            prefix: {value: "["}
                            suffix: {value: "]"}
                        - expression:
                            description: "..."
                            type: Expression
                            optional: true
                            prefix: {value: " = "}
                        - name1:
                            description: "..."
                            type: Name
                            optional: true
                            prefix: {value: " = "}
                            suffix: {value: "*"}
                        - del2:
                            description: "..."
                            type: Name
                            optional: true
                            suffix: {value: "("}
                        - name2:
                            description: "..."
                            type: Name
                            optional: true
                            suffix: {value: ")"}
                        - name3:
                            description: "..."
                            type: Name
                            optional: true
                            prefix: {value: "+"}
                  - WatchStatement:
                      description: ".."
                      nmodl: "WATCH "
                      members:
                        - statements:
                            description: "..."
                            type: Watch
                            vector: true
                            separator: ","
                            add: true
                  - MutexLock:
                      description: ".."
                      nmodl: MUTEXLOCK
                  - MutexUnlock:
                      description: ".."
                      nmodl: MUTEXUNLOCK
                  - Reset:
                      description: ".."
                      nmodl: RESET
                  - Sens:
                      description: ".."
                      nmodl: "SENS "
                      members:
                        - variables:
                            description: "..."
                            type: VarName
                            vector: true
                            separator: ", "
                  - Conserve:
                      description: ".."
                      nmodl: CONSERVE
                      members:
                        - react:
                            description: "..."
                            type: Expression
                            prefix: {value: " "}
                        - expr:
                            description: "..."
                            type: Expression
                            prefix: {value: " = "}
                  - Compartment:
                      description: ".."
                      nmodl: COMPARTMENT
                      members:
                        - name:
                            description: "..."
                            type: Name
                            optional: true
                            prefix: {value: " "}
                            suffix: {value: ","}
                        - expression:
                            description: "..."
                            type: Expression
                            prefix: {value: " "}
                        - names:
                            description: "..."
                            type: Name
                            vector: true
                            prefix: {value: " {"}
                            suffix: {value: "}"}
                            separator: " "
                  - LonDifuse:
                      description: ".."
                      nmodl: LONGITUDINAL_DIFFUSION
                      members:
                        - name:
                            description: "..."
                            type: Name
                            optional: true
                            prefix: {value: " "}
                            suffix: {value: ","}
                        - expression:
                            description: "..."
                            type: Expression
                            prefix: {value: " "}
                        - names:
                            description: "..."
                            type: Name
                            vector: true
                            prefix: {value: " {"}
                            suffix: {value: "}"}
                            separator: " "
                  - ReactionStatement:
                      description: ".."
                      nmodl: "~ "
                      members:
                        - reaction1:
                            description: "..."
                            type: Expression
                        - op:
                            description: "..."
                            type: ReactionOperator
                            prefix: {value: " "}
                        - reaction2:
                            description: "..."
                            type: Expression
                            prefix: {value: " "}
                            optional: true
                        - expression1:
                            description: "..."
                            type: Expression
                            prefix: {value: " ("}
                        - expression2:
                            description: "..."
                            type: Expression
                            prefix: {value: ", "}
                            suffix: {value: ")", force: true}
                            optional: true
                  - LagStatement:
                      description: ".."
                      nmodl: "LAG "
                      members:
                        - name:
                            description: "..."
                            type: Identifier
                        - byname:
                            description: "..."
                            type: Name
                            prefix: {value: " BY "}
                  - QueueStatement:
                      description: ".."
                      members:
                        - qtype:
                            description: "..."
                            type: QueueExpressionType
                        - name:
                            description: "..."
                            type: Identifier
                            prefix: {value: " "}
                  - ConstantStatement:
                      description: ".."
                      members:
                        - constant:
                            description: "..."
                            type: ConstantVar
                  - TableStatement:
                      description: ".."
                      nmodl: "TABLE "
                      members:
                        - table_vars:
                            description: "..."
                            type: Name
                            vector: true
                            separator: ","
                        - depend_vars:
                            description: "..."
                            type: Name
                            vector: true
                            prefix: {value: " DEPEND "}
                            separator: ","
                        - from:
                            description: "..."
                            type: Expression
                            prefix: {value: " FROM "}
                        - to:
                            description: "..."
                            type: Expression
                            prefix: {value: " TO "}
                        - with:
                            description: "..."
                            type: Integer
                            prefix: {value: " WITH "}
                  - Suffix:
                      description: ".."
                      members:
                        - type:
                            description: "..."
                            type: Name
                            suffix: {value: " "}
                        - name:
                            description: "..."
                            type: Name
                            node_name: true
                  - Useion:
                      description: ".."
                      nmodl: "USEION "
                      members:
                        - name:
                            description: "..."
                            type: Name
                            node_name: true
                        - readlist:
                            description: "..."
                            type: ReadIonVar
                            vector: true
                            prefix: {value: " READ "}
                            separator: ", "
                        - writelist:
                            description: "..."
                            type: WriteIonVar
                            vector: true
                            prefix: {value: " WRITE "}
                            separator: ", "
                        - valence:
                            description: "..."
                            type: Valence
                            optional: true
                  - Nonspecific:
                      description: ".."
                      nmodl: "NONSPECIFIC_CURRENT "
                      members:
                        - currents:
                            description: "..."
                            type: NonspecificCurVar
                            vector: true
                            separator: ", "
                  - ElctrodeCurrent:
                      description: ".."
                      nmodl: "ELECTRODE_CURRENT "
                      members:
                        - currents:
                            description: "..."
                            type: ElectrodeCurVar
                            vector: true
                            separator: ", "
                  - Section:
                      description: ".."
                      nmodl: "SECTION "
                      members:
                        - sections:
                            description: "..."
                            type: SectionVar
                            vector: true
                            separator: ", "
                  - Range:
                      description: ".."
                      nmodl: "RANGE "
                      members:
                        - variables:
                            description: "..."
                            type: RangeVar
                            vector: true
                            separator: ", "
                  - Global:
                      description: ".."
                      nmodl: "GLOBAL "
                      members:
                        - variables:
                            description: "..."
                            type: GlobalVar
                            vector: true
                            separator: ", "
                  - Pointer:
                      description: ".."
                      nmodl: "POINTER "
                      members:
                        - variables:
                            description: "..."
                            type: PointerVar
                            vector: true
                            separator: ", "
                  - BbcorePtr:
                      description: ".."
                      nmodl: "BBCOREPOINTER "
                      members:
                        - variables:
                            description: "..."
                            type: BbcorePointerVar
                            vector: true
                            separator: ", "
                  - External:
                      description: ".."
                      nmodl: "EXTERNAL "
                      members:
                        - variables:
                            description: "..."
                            type: ExternVar
                            vector: true
                            separator: ", "
                  - ThreadSafe:
                      description: ".."
                      nmodl: THREADSAFE
                      members:
                        - variables:
                            description: "..."
                            type: ThreadsafeVar
                            vector: true
                            separator: ", "
                            prefix: {value: " "}
                  - Verbatim:
                      description: "Represents a C code block"
                      nmodl: VERBATIM
                      members:
                        - statement:
                            description: "C code as a string"
                            type: String
                            suffix: {value: "ENDVERBATIM"}
                  - LineComment:
                      description: "Represents a one line comment in NMODL"
                      members:
                        - statement:
                            description: "comment text"
                            type: String
                  - BlockComment:
                      description: "Represents a multi-line comment in NMODL"
                      nmodl: COMMENT
                      members:
                        - statement:
                            description: "comment text"
                            type: String
                            suffix: {value: "ENDCOMMENT"}

- Program:
    description: "Represents top level AST node for whole NMODL input"
    members:
      - blocks:
          description: "..."
          type: Node
          vector: true
          add: true
          public: true

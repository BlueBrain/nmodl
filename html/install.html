<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installing the NMODL Framework &mdash; NMODL  documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The NEURON MODeling language" href="language.html" />
    <link rel="prev" title="Introduction" href="readme.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> NMODL
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p><span class="caption-text">Introduction:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installing the NMODL Framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cloning-source">Cloning Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#on-os-x">On OS X</a></li>
<li class="toctree-l3"><a class="reference internal" href="#on-ubuntu">On Ubuntu</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#build-project">Build Project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-cmake">Using CMake</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#flex-bison-paths">Flex / Bison Paths</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#using-python-setuptools">Using Python setuptools</a></li>
<li class="toctree-l3"><a class="reference internal" href="#when-building-without-linking-against-libpython">When building without linking against libpython</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#testing-the-installed-module">Testing the Installed Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="#generating-documentation">Generating Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="language.html">The NEURON MODeling language</a></li>
</ul>
<p><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contents/visitors.html">Visitors</a></li>
</ul>
<p><span class="caption-text">Jupyter Notebooks:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notebooks.html">The NMODL Jupyter notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-python-tutorial.html">NMODL Python Interface Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-odes-overview.html">NMODL integration of ODEs</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-kinetic-schemes.html">NMODL Kinetic Scheme</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-sympy-solver-cnexp.html">NMODL SympySolver - cnexp</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-sympy-solver-sparse.html">NMODL SympySolver - sparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-sympy-solver-derivimplicit.html">NMODL SympySolver - derivimplicit</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-linear-solver.html">NMODL LINEAR solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-nonlinear-solver.html">NMODL NONLINEAR solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-sympy-conductance.html">NMODL CONDUCTANCE</a></li>
</ul>
<p><span class="caption-text">Contributing:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to the NMODL Framework</a></li>
</ul>
<p><span class="caption-text">Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Python package</a></li>
<li class="toctree-l1"><a class="reference internal" href="doxygen.html">C++ API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NMODL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Installing the NMODL Framework</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/install.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="installing-the-nmodl-framework">
<h1>Installing the NMODL Framework<a class="headerlink" href="#installing-the-nmodl-framework" title="Permalink to this headline">¶</a></h1>
<section id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>These instructions will get you a copy of the project up and running on your local machine for development and testing purposes.</p>
</section>
<section id="cloning-source">
<h2>Cloning Source<a class="headerlink" href="#cloning-source" title="Permalink to this headline">¶</a></h2>
<p>The NMODL Framework is maintained on github. The best way to get the sources is to simply clone the repository.</p>
<p><strong>Note</strong>: This project uses git submodules which must be cloned along with the repository itself:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git clone --recursive https://github.com/BlueBrain/nmodl.git
<span class="nb">cd</span> nmodl
</pre></div>
</div>
</section>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>To build the project from source, a modern C++ compiler with c++11 support is necessary. Make sure you have following packages available:</p>
<ul class="simple">
<li><p>flex (&gt;=2.6)</p></li>
<li><p>bison (&gt;=3.0)</p></li>
<li><p>CMake (&gt;=3.3)</p></li>
<li><p>Python (&gt;=3.6)</p></li>
<li><p>Python packages : jinja2 (&gt;=2.10), pyyaml (&gt;=3.13), pytest (&gt;=4.0.0), sympy (&gt;=1.3), textwrap</p></li>
</ul>
<section id="on-os-x">
<h3>On OS X<a class="headerlink" href="#on-os-x" title="Permalink to this headline">¶</a></h3>
<p>Typically the versions of bison and flex provided by the system are outdated and not compatible with our requirements.
To get recent version of all dependencies we recommend using <a class="reference external" href="https://brew.sh/">homebrew</a>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>brew install flex bison cmake python3
</pre></div>
</div>
<p>The necessary Python packages can then easily be added using the pip3 command.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip3 install Jinja2 PyYAML pytest sympy
</pre></div>
</div>
<p>Make sure to have latest flex/bison in $PATH :</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>/usr/local/opt/flex/bin:/usr/local/opt/bison/bin:/usr/local/bin/:<span class="nv">$PATH</span>
</pre></div>
</div>
<p>On Apple M1, corresponding brew paths are under <code class="docutils literal notranslate"><span class="pre">/opt/homebrew/opt/</span></code>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>/opt/homebrew/opt/flex/bin:/opt/homebrew/opt/bison/bin:<span class="nv">$PATH</span>
</pre></div>
</div>
</section>
<section id="on-ubuntu">
<h3>On Ubuntu<a class="headerlink" href="#on-ubuntu" title="Permalink to this headline">¶</a></h3>
<p>On Ubuntu (&gt;=18.04) flex/bison versions are recent enough and are installed along with the system toolchain:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>apt-get install flex bison gcc python3 python3-pip
</pre></div>
</div>
<p>The Python dependencies are installed using:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip3 install Jinja2 PyYAML pytest sympy
</pre></div>
</div>
</section>
</section>
<section id="build-project">
<h2>Build Project<a class="headerlink" href="#build-project" title="Permalink to this headline">¶</a></h2>
<section id="using-cmake">
<h3>Using CMake<a class="headerlink" href="#using-cmake" title="Permalink to this headline">¶</a></h3>
<p>Once all dependencies are in place, build project as:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>mkdir -p nmodl/build
<span class="nb">cd</span> nmodl/build
cmake .. -DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$HOME</span>/nmodl
make -j <span class="o">&amp;&amp;</span> make install
</pre></div>
</div>
<p>And set PYTHONPATH as:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$HOME</span>/nmodl/lib:<span class="nv">$PYTHONPATH</span>
</pre></div>
</div>
<section id="flex-bison-paths">
<h4>Flex / Bison Paths<a class="headerlink" href="#flex-bison-paths" title="Permalink to this headline">¶</a></h4>
<p>If flex / bison are not in your default $PATH, you can provide the path to cmake as:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>cmake .. -DFLEX_EXECUTABLE<span class="o">=</span>/usr/local/opt/flex/bin/flex <span class="se">\</span>
         -DBISON_EXECUTABLE<span class="o">=</span>/usr/local/opt/bison/bin/bison <span class="se">\</span>
         -DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="nv">$HOME</span>/nmodl
</pre></div>
</div>
</section>
</section>
<section id="using-python-setuptools">
<h3>Using Python setuptools<a class="headerlink" href="#using-python-setuptools" title="Permalink to this headline">¶</a></h3>
<p>If you are mainly interested in the NMODL Framework parsing and analysis tools and wish to use them from Python, we
recommend building and installing using Python.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip3 install --user .
</pre></div>
</div>
<p>This should build the NMODL framework and install it into your pip user <code class="docutils literal notranslate"><span class="pre">site-packages</span></code> folder such that it becomes
available as a Python module.</p>
</section>
<section id="when-building-without-linking-against-libpython">
<h3>When building without linking against libpython<a class="headerlink" href="#when-building-without-linking-against-libpython" title="Permalink to this headline">¶</a></h3>
<p>NMODL uses an embedded python to symbolically evaluate differential equations. For this to work we would usually link
against libpython, which is automatically taken care of by pybind11. In some cases, for instance when building a
python wheel, we cannot link against libpython, because we cannot know where it will be at runtime. Instead, we load
the python library (along with a wrapper library that manages calls to embedded python) at runtime.
To disable linking against python and enabling dynamic loading of libpython at runtime we need to configure the build
with the cmake option <code class="docutils literal notranslate"><span class="pre">-DLINK_AGAINST_PYTHON=False</span></code>.</p>
<p>In order for NMODL binaries to know where to find libpython and our own libpywrapper two environment variables need to
be present:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">NMODL_PYLIB</span></code>: This variable should point to the libpython shared-object (or dylib) file. On macos this could be
for example:
.. code-block:: sh</p>
<blockquote>
<div><p>export NMODL_PYLIB=/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/Python</p>
</div></blockquote>
</li>
<li><p>‘NMODL_WRAPLIB’: This variable should point to the <code class="docutils literal notranslate"><span class="pre">libpywrapper.so</span></code> built as part of NMODL, for example:
.. code-block:: sh</p>
<blockquote>
<div><p>export NMODL_WRAPLIB=/opt/nmodl/lib/libpywrapper.so</p>
</div></blockquote>
</li>
</ul>
<p><strong>Note</strong>: In order for all unit tests to function correctly when building without linking against libpython we must
set <code class="docutils literal notranslate"><span class="pre">NMODL_PYLIB</span></code> before running cmake!</p>
</section>
</section>
<section id="testing-the-installed-module">
<h2>Testing the Installed Module<a class="headerlink" href="#testing-the-installed-module" title="Permalink to this headline">¶</a></h2>
<p>If you have installed the NMODL Framework using CMake, you can now run tests from the build directory as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ make <span class="nb">test</span>
Running tests...
Test project /Users/kumbhar/workarena/repos/bbp/incubator/nocmodl/cmake-build-debug
      Start  <span class="m">1</span>: testmodtoken/NMODL Lexer returning valid ModToken object
 <span class="m">1</span>/60 Test  <span class="c1">#1: testmodtoken/NMODL Lexer returning valid ModToken object ...................................   Passed    0.01 sec</span>
      Start  <span class="m">2</span>: testlexer/NMODL Lexer returning valid token types
 <span class="m">2</span>/60 Test  <span class="c1">#2: testlexer/NMODL Lexer returning valid token types ..........................................   Passed    0.00 sec</span>
      Start  <span class="m">3</span>: testparser/Scenario: NMODL can define macros using DEFINE keyword
 <span class="m">3</span>/60 Test  <span class="c1">#3: testparser/Scenario: NMODL can define macros using DEFINE keyword ..........................   Passed    0.01 sec</span>
      Start  <span class="m">4</span>: testparser/Scenario: Macros can be used anywhere <span class="k">in</span> the mod file
 <span class="m">4</span>/60 Test  <span class="c1">#4: testparser/Scenario: Macros can be used anywhere in the mod file ...........................   Passed    0.01 sec</span>
      Start  <span class="m">5</span>: testparser/Scenario: NMODL parser accepts empty unit specification
 <span class="m">5</span>/60 Test  <span class="c1">#5: testparser/Scenario: NMODL parser accepts empty unit specification .........................   Passed    0.01 sec</span>
      Start  <span class="m">6</span>: testparser/Scenario: NMODL parser running number of valid NMODL constructs
 <span class="m">6</span>/60 Test  <span class="c1">#6: testparser/Scenario: NMODL parser running number of valid NMODL constructs .................   Passed    0.04 sec</span>
      Start  <span class="m">7</span>: testparser/Scenario: NMODL parser running number of invalid NMODL constructs
 <span class="m">7</span>/60 Test  <span class="c1">#7: testparser/Scenario: NMODL parser running number of invalid NMODL constructs ...............   Passed    0.01 sec</span>
      Start  <span class="m">8</span>: testparser/Scenario: Legacy differential equation solver from NEURON solve number of ODE
 <span class="m">8</span>/60 Test  <span class="c1">#8: testparser/Scenario: Legacy differential equation solver from NEURON solve number of ODE ...   Passed    0.00 sec</span>
 ...
</pre></div>
</div>
<p>To test the NMODL Framework python bindings, you can try a minimal example in your Python 3 interpeter as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">nmodl.dsl</span> <span class="k">as</span> <span class="nn">nmodl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">driver</span> <span class="o">=</span> <span class="n">nmodl</span><span class="o">.</span><span class="n">NmodlDriver</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">modast</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">parse_string</span><span class="p">(</span><span class="s2">&quot;NEURON { SUFFIX hh }&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">modast</span><span class="p">)</span>
<span class="go">{&quot;Program&quot;:[{&quot;NeuronBlock&quot;:[{&quot;StatementBlock&quot;:[{&quot;Suffix&quot;:[{&quot;Name&quot;:[{&quot;String&quot;:[{&quot;name&quot;:&quot;SUFFIX&quot;}]}]},{&quot;Name&quot;:[{&quot;String&quot;:[{&quot;name&quot;:&quot;hh&quot;}]}]}]}]}]}]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="p">(</span><span class="n">nmodl</span><span class="o">.</span><span class="n">to_nmodl</span><span class="p">(</span><span class="n">modast</span><span class="p">))</span>
<span class="go">NEURON {</span>
<span class="go">    SUFFIX hh</span>
<span class="go">}</span>
</pre></div>
</div>
<p>NMODL is now setup correctly!</p>
</section>
<section id="generating-documentation">
<h2>Generating Documentation<a class="headerlink" href="#generating-documentation" title="Permalink to this headline">¶</a></h2>
<p>In order to build the documentation you must have additionally <code class="docutils literal notranslate"><span class="pre">pandoc</span></code> installed. Use your
system’s package manager to do this (e.g. <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">pandoc</span></code>).</p>
<p>You can build the entire documentation simply by using sphinx from <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python3 setup.py build_ext --inplace docs -G <span class="s2">&quot;Unix Makefiles&quot;</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="readme.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="language.html" class="btn btn-neutral float-right" title="The NEURON MODeling language" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, BlueBrain HPC team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installing the NMODL Framework &mdash; NMODL 0.6 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The NEURON MODeling language" href="language.html" />
    <link rel="prev" title="Introduction" href="readme.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            NMODL
          </a>
              <div class="version">
                0.6
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installing the NMODL Framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cloning-source">Cloning Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-project">Build Project</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="language.html">The NEURON MODeling language</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contents/visitors.html">Visitors</a></li>
<li class="toctree-l1"><a class="reference internal" href="contents/ions.html">Ions</a></li>
<li class="toctree-l1"><a class="reference internal" href="contents/pointers.html">NMODL “pointers”</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Jupyter Notebooks:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="notebooks.html">The NMODL Jupyter notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-python-tutorial.html">NMODL Python Interface Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-odes-overview.html">NMODL integration of ODEs</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-kinetic-schemes.html">NMODL Kinetic Scheme</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-sympy-solver-cnexp.html">NMODL SympySolver - cnexp</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-sympy-solver-sparse.html">NMODL SympySolver - sparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-sympy-solver-derivimplicit.html">NMODL SympySolver - derivimplicit</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-linear-solver.html">NMODL LINEAR solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-nonlinear-solver.html">NMODL NONLINEAR solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/nmodl-sympy-conductance.html">NMODL CONDUCTANCE</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to the NMODL Framework</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Python package</a></li>
<li class="toctree-l1"><a class="reference internal" href="doxygen.html">C++ API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">NMODL</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Installing the NMODL Framework</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/install.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installing-the-nmodl-framework">
<h1>Installing the NMODL Framework<a class="headerlink" href="#installing-the-nmodl-framework" title="Permalink to this heading"></a></h1>
<section id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this heading"></a></h2>
<p>These instructions will get you a copy of the project up and running on
your local machine for development and testing purposes.</p>
</section>
<section id="cloning-source">
<h2>Cloning Source<a class="headerlink" href="#cloning-source" title="Permalink to this heading"></a></h2>
<p>The NMODL Framework is maintained on github. The best way to get the
sources is to simply clone the repository.</p>
<p><strong>Note</strong>: This project uses git submodules which must be cloned along
with the repository itself:</p>
<p>.. code:: sh</p>
<p>git clone –recursive https://github.com/BlueBrain/nmodl.git
cd nmodl</p>
</section>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading"></a></h2>
<p>To build the project from source, a modern C++ compiler with C++14
support is necessary. Make sure you have following packages available:</p>
<ul class="simple">
<li><p>flex (&gt;=2.6)</p></li>
<li><p>bison (&gt;=3.0)</p></li>
<li><p>CMake (&gt;=3.15)</p></li>
<li><p>Python (&gt;=3.8)</p></li>
<li><p>Python packages : jinja2 (&gt;=2.10), pyyaml (&gt;=3.13), pytest (&gt;=4.0.0),
sympy (&gt;=1.3), textwrap</p></li>
</ul>
<p>On OS X</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
Typically the versions of bison and flex provided by the system are
outdated and not compatible with our requirements. To get recent version
of all dependencies we recommend using `homebrew &lt;https://brew.sh/&gt;`__:

.. code:: sh

   brew install flex bison cmake python3

The necessary Python packages can then easily be added using the pip3
command.

.. code:: sh

   pip3 install --user -r requirements.txt

Make sure to have latest flex/bison in $PATH :

.. code:: sh

   export PATH=/usr/local/opt/flex/bin:/usr/local/opt/bison/bin:/usr/local/bin/:$PATH

On Apple M1, corresponding brew paths are under ``/opt/homebrew/opt/``:

.. code:: sh

   export PATH=/opt/homebrew/opt/flex/bin:/opt/homebrew/opt/bison/bin:$PATH

On Ubuntu
</pre></div>
</div>
<p>On Ubuntu (&gt;=18.04) flex/bison versions are recent enough and are
installed along with the system toolchain:</p>
<p>.. code:: sh</p>
<p>apt-get install flex bison gcc python3 python3-pip</p>
<p>The Python dependencies are installed using:</p>
<p>.. code:: sh</p>
<p>pip3 install –user -r requirements.txt</p>
</section>
<section id="build-project">
<h2>Build Project<a class="headerlink" href="#build-project" title="Permalink to this heading"></a></h2>
<p>Using CMake</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
Once all dependencies are in place, build project as:

.. code:: sh

   mkdir -p nmodl/build
   cd nmodl/build
   cmake .. -DCMAKE_INSTALL_PREFIX=$HOME/nmodl
   cmake --build . --parallel 4 --target install

.. hint::

   By default ``NMODL`` is build with the ``CMake`` option
   ``NMODL_ENABLE_PYTHON_BINDINGS`` set to ``ON`` which increases a lot
   the compilation complexity and memory requirements. For that purpose
   it’s recommended to either disable this option if the Python bindings
   are not needed or restrict the number of parallel jobs running in
   parallel in the ``cmake`` command using
   ``cmake --parallel &lt;number_of_parallel_jobs&gt;``. i.e. in a machine
   with 8 threads do ``cmake --parallel 4``.

And set PYTHONPATH as:

.. code:: sh

   export PYTHONPATH=$HOME/nmodl/lib:$PYTHONPATH

Flex / Bison Paths
^^^^^^^^^^^^^^^^^^

If flex / bison are not in your default $PATH, you can provide the path
to cmake as:

.. code:: sh

   cmake .. -DFLEX_EXECUTABLE=/usr/local/opt/flex/bin/flex \
            -DBISON_EXECUTABLE=/usr/local/opt/bison/bin/bison \
            -DCMAKE_INSTALL_PREFIX=$HOME/nmodl

Using Python setuptools
</pre></div>
</div>
<p>If you are mainly interested in the NMODL Framework parsing and analysis
tools and wish to use them from Python, we recommend building and
installing using Python.</p>
<p>.. code:: sh</p>
<p>pip3 install –user .</p>
<p>This should build the NMODL framework and install it into your pip user
<code class="docutils literal notranslate"><span class="pre">site-packages</span></code> folder such that it becomes available as a Python
module.</p>
<p>When building without linking against libpython</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
NMODL uses an embedded python to symbolically evaluate differential
equations. For this to work we would usually link against libpython,
which is automatically taken care of by pybind11. In some cases, for
instance when building a python wheel, we cannot link against libpython,
because we cannot know where it will be at runtime. Instead, we load the
python library (along with a wrapper library that manages calls to
embedded python) at runtime. To disable linking against python and
enabling dynamic loading of libpython at runtime we need to configure
the build with the cmake option ``-DLINK_AGAINST_PYTHON=False``.

In order for NMODL binaries to know where to find libpython and our own
libpywrapper two environment variables need to be present:

-  ``NMODL_PYLIB``: This variable should point to the libpython
   shared-object (or dylib) file. On macos this could be for example:

.. code:: sh

   export NMODL_PYLIB=/usr/local/Cellar/python/3.7.7/Frameworks/Python.framework/Versions/3.7/Python

**Note**: In order for all unit tests to function correctly when
building without linking against libpython we must set ``NMODL_PYLIB``
before running cmake!

Testing the Installed Module
----------------------------

If you have installed the NMODL Framework using CMake, you can now run
tests from the build directory as:

.. code:: bash

   $ make test
   Running tests...
   Test project /Users/kumbhar/workarena/repos/bbp/incubator/nocmodl/cmake-build-debug
         Start  1: testmodtoken/NMODL Lexer returning valid ModToken object
    1/60 Test  #1: testmodtoken/NMODL Lexer returning valid ModToken object ...................................   Passed    0.01 sec
         Start  2: testlexer/NMODL Lexer returning valid token types
    2/60 Test  #2: testlexer/NMODL Lexer returning valid token types ..........................................   Passed    0.00 sec
         Start  3: testparser/Scenario: NMODL can define macros using DEFINE keyword
    3/60 Test  #3: testparser/Scenario: NMODL can define macros using DEFINE keyword ..........................   Passed    0.01 sec
         Start  4: testparser/Scenario: Macros can be used anywhere in the mod file
    4/60 Test  #4: testparser/Scenario: Macros can be used anywhere in the mod file ...........................   Passed    0.01 sec
         Start  5: testparser/Scenario: NMODL parser accepts empty unit specification
    5/60 Test  #5: testparser/Scenario: NMODL parser accepts empty unit specification .........................   Passed    0.01 sec
         Start  6: testparser/Scenario: NMODL parser running number of valid NMODL constructs
    6/60 Test  #6: testparser/Scenario: NMODL parser running number of valid NMODL constructs .................   Passed    0.04 sec
         Start  7: testparser/Scenario: NMODL parser running number of invalid NMODL constructs
    7/60 Test  #7: testparser/Scenario: NMODL parser running number of invalid NMODL constructs ...............   Passed    0.01 sec
         Start  8: testparser/Scenario: Legacy differential equation solver from NEURON solve number of ODE
    8/60 Test  #8: testparser/Scenario: Legacy differential equation solver from NEURON solve number of ODE ...   Passed    0.00 sec
    ...

To test the NMODL Framework python bindings, you can try a minimal
example in your Python 3 interpeter as follows:

.. code:: python

   &gt;&gt;&gt; import nmodl.dsl as nmodl
   &gt;&gt;&gt; driver = nmodl.NmodlDriver()
   &gt;&gt;&gt; modast = driver.parse_string(&quot;NEURON { SUFFIX hh }&quot;)
   &gt;&gt;&gt; print (&#39;%s&#39; % modast)
   {&quot;Program&quot;:[{&quot;NeuronBlock&quot;:[{&quot;StatementBlock&quot;:[{&quot;Suffix&quot;:[{&quot;Name&quot;:[{&quot;String&quot;:[{&quot;name&quot;:&quot;SUFFIX&quot;}]}]},{&quot;Name&quot;:[{&quot;String&quot;:[{&quot;name&quot;:&quot;hh&quot;}]}]}]}]}]}]}
   &gt;&gt;&gt; print (nmodl.to_nmodl(modast))
   NEURON {
       SUFFIX hh
   }

NMODL is now setup correctly!

Generating Documentation
------------------------

In order to build the documentation you must have additionally
``pandoc`` installed. Use your system’s package manager to do this
(e.g. ``sudo apt-get install pandoc``).

You can build the entire documentation simply by using sphinx from
``setup.py``:

.. code:: sh

   python3 setup.py build_ext --inplace docs
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="readme.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="language.html" class="btn btn-neutral float-right" title="The NEURON MODeling language" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, BlueBrain HPC team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>